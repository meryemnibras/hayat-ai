# ุฅุนุฏุงุฏ LangChain - Hayat AI Clinic

## โ ูุง ุชู ุฅูุฌุงุฒู

ุชู ุฅุนุฏุงุฏ LangChain ุจุดูู ูุงูู ูุน ุงูููุฒุงุช ุงูุชุงููุฉ:

### 1. **Memory System (ูุธุงู ุงูุฐุงูุฑุฉ)**

ุชู ุฅูุดุงุก ูุธุงู ุฐุงูุฑุฉ ูุชูุฏู ูุณุชุฎุฏู ูุงุนุฏุฉ ุงูุจูุงูุงุช Prisma ูุชุฎุฒูู ูุงุณุชุฑุฌุงุน ุชุงุฑูุฎ ุงููุญุงุฏุซุงุช:

- **`PrismaMessageHistory`** (`lib/ai/memory/PrismaMessageHistory.ts`):
  - ููุชุฏ ูู `BaseChatMessageHistory` ูู LangChain
  - ูุฑุจุท ุจูู LangChain ููุงุนุฏุฉ ุงูุจูุงูุงุช
  - ูุญูุธ ููุณุชุนูุฏ ุงูุฑุณุงุฆู ูู ุฌุฏูู `Message` ูู Prisma
  - ูุฏุนู ุญุฏ ุฃูุตู ููุฑุณุงุฆู (ุงูุชุฑุงุถู: 20 ุฑุณุงูุฉ)

- **`MemoryManager`** (`lib/ai/memory/MemoryManager.ts`):
  - ูุฏูุฑ ุฅูุดุงุก ูุงุณุชุฑุฌุงุน ุงูุฐุงูุฑุฉ
  - ููุดุฆ `BufferMemory` ูุน ุชุงุฑูุฎ ุงููุญุงุฏุซุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
  - ููุดุฆ ุฃู ูุณุชุฑุฌุน ูุญุงุฏุซุฉ ูููุฑูุถ ุชููุงุฆูุงู

### 2. **System Prompt ูุญุณูู**

ุชู ุชุญุณูู System Prompt ุจุดูู ูุจูุฑ ููุดูู:

- **ูููุฉ ูุงุถุญุฉ**: ุชุนุฑูู ุฏูุฑ Hayat Agent
- **ุงููุบุงุช ุงููุฏุนููุฉ**: ุงูุนุฑุจูุฉุ ุงูุชุฑููุฉุ ุงูุฅูุฌููุฒูุฉุ ุงููุฑูุณูุฉ
- **ููุงุนุฏ ูููุฉ**: ุนุฏู ุชูุฏูู ุชุดุฎูุตุงุช ุทุจูุฉุ ุงุญุชุฑุงู ุงูุฎุตูุตูุฉ
- **ุงูุฃุฏูุงุช ุงููุชุงุญุฉ**: ุดุฑุญ ูุงุถุญ ููู ุฃุฏุงุฉ
- **ุฃุณููุจ ุงูุชูุงุตู**: ุฅุฑุดุงุฏุงุช ููุชูุงุตู ุงููุฏู ูุงููููู
- **ุญุงูุงุช ุงูุชุตุนูุฏ**: ูุชู ูุฌุจ ุงูุชุตุนูุฏ ูููุธู ุจุดุฑู

### 3. **HayatAgent ูุญุณูู**

ุชู ุชุญุฏูุซ `HayatAgent` ูุงุณุชุฎุฏุงู Memory:

- **Memory Cache**: ุชุฎุฒูู ูุคูุช ููุฐุงูุฑุฉ ููู ูุญุงุฏุซุฉ
- **ุงุณุชุฑุฌุงุน ุงูุชุงุฑูุฎ**: ุชุญููู ุชุงุฑูุฎ ุงููุญุงุฏุซุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- **ุญูุธ ุชููุงุฆู**: ุญูุธ ุงูุฑุณุงุฆู ุงูุฌุฏูุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- **ุฏุนู conversationId**: ุฑุจุท ุงููุญุงุฏุซุงุช ุจุงูุฐุงูุฑุฉ

### 4. **API Routes ูุญุฏุซุฉ**

ุชู ุชุญุฏูุซ API routes ูุชูุฑูุฑ `conversationId` ู `clinicId`:

- **`/api/ai/chat`**: 
  - ููุจู `conversationId` ุงุฎุชูุงุฑู
  - ููุดุฆ ูุญุงุฏุซุฉ ุชููุงุฆูุงู ุฅุฐุง ูู ูุชู ุชูููุฑ `conversationId`
  - ูุนูุฏ `conversationId` ูู ุงูุงุณุชุฌุงุจุฉ

- **`/api/webhooks/whatsapp`**:
  - ูุณุชุฎุฏู `conversationId` ูู ุงููุญุงุฏุซุฉ ุงูููุฌูุฏุฉ
  - ูุฑุจุท ุงูุฐุงูุฑุฉ ุจุงููุญุงุฏุซุฉ ูู WhatsApp

## ๐ ุงููููุงุช ุงูุฌุฏูุฏุฉ

```
hayat-ai/
โโโ lib/
โ   โโโ ai/
โ       โโโ agents/
โ       โ   โโโ HayatAgent.ts (ูุญุฏุซ)
โ       โโโ memory/
โ           โโโ PrismaMessageHistory.ts (ุฌุฏูุฏ)
โ           โโโ MemoryManager.ts (ุฌุฏูุฏ)
โโโ app/
    โโโ api/
        โโโ ai/
        โ   โโโ chat/
        โ       โโโ route.ts (ูุญุฏุซ)
        โโโ webhooks/
            โโโ whatsapp/
                โโโ route.ts (ูุญุฏุซ)
```

## ๐ง ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุงุณุชุฎุฏุงู API Chat

```typescript
// ุจุฏูู conversationId (ุณูุชู ุฅูุดุงุก ูุญุงุฏุซุฉ ุฌุฏูุฏุฉ)
POST /api/ai/chat
{
  "message": "ุฃุฑูุฏ ุญุฌุฒ ููุนุฏ",
  "patientId": "patient_123",
  "clinicId": "clinic_456" // ุงุฎุชูุงุฑูุ ูุณุชุฎุฏู DEFAULT_CLINIC_ID
}

// ูุน conversationId (ูุณุชุฎุฏู ุชุงุฑูุฎ ุงููุญุงุฏุซุฉ)
POST /api/ai/chat
{
  "message": "ูุชู ููุนุฏูุ",
  "patientId": "patient_123",
  "conversationId": "conv_789",
  "clinicId": "clinic_456"
}
```

### 2. ุงุณุชุฎุฏุงู HayatAgent ูุจุงุดุฑุฉ

```typescript
import { getHayatAgent } from "@/lib/ai/agents/HayatAgent";
import { MemoryManager } from "@/lib/ai/memory/MemoryManager";

const agent = getHayatAgent();

// ูุน ูุญุงุฏุซุฉ ุฌุฏูุฏุฉ
const conversationId = await MemoryManager.getOrCreateConversation(
  patientId,
  clinicId,
  "CHAT"
);

const result = await agent.chat({
  message: "ูุฑุญุจุงู",
  patientId,
  conversationId,
  clinicId,
});
```

## ๐ฏ ุงูููุฒุงุช

### โ Memory System
- ุญูุธ ูุงุณุชุฑุฌุงุน ุชุงุฑูุฎ ุงููุญุงุฏุซุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุฏุนู ุญุชู 20 ุฑุณุงูุฉ ูู ุงูุฐุงูุฑุฉ (ูุงุจู ููุชุนุฏูู)
- ุชุญุฏูุซ ุชููุงุฆู ูู `lastMessageAt` ูู ุงููุญุงุฏุซุฉ

### โ System Prompt ูุญุณูู
- ุฅุฑุดุงุฏุงุช ูุงุถุญุฉ ููู AI
- ุฏุนู ูุชุนุฏุฏ ุงููุบุงุช
- ููุงุนุฏ ุฃูุงู ูุฎุตูุตูุฉ

### โ Integration ูุน Prisma
- ุฑุจุท ูุจุงุดุฑ ูุน ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุญูุธ ุชููุงุฆู ููุฑุณุงุฆู
- ุงุณุชุฑุฌุงุน ุฐูู ูููุญุงุฏุซุงุช

## ๐ ููุงุญุธุงุช ูููุฉ

1. **Memory Cache**: ูุชู ุชุฎุฒูู ุงูุฐุงูุฑุฉ ูู cache ูุญูู ูุชูููู ุงุณุชุนูุงูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
2. **Max Messages**: ุงูุญุฏ ุงูุฃูุตู ููุฑุณุงุฆู ูู ุงูุฐุงูุฑุฉ ูู 20 (ูุงุจู ููุชุนุฏูู ูู `MemoryManager.createMemory`)
3. **Conversation ID**: ุฅุฐุง ูู ูุชู ุชูููุฑ `conversationId`ุ ุณูุชู ุฅูุดุงุก ูุญุงุฏุซุฉ ุฌุฏูุฏุฉ ุชููุงุฆูุงู
4. **Error Handling**: ูู ุญุงูุฉ ูุดู ุชุญููู ุงูุฐุงูุฑุฉุ ุณูุณุชูุฑ ุงูู Agent ุจุฏูู ุชุงุฑูุฎ ุงููุญุงุฏุซุฉ

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ (ุงุฎุชูุงุฑู)

- [ ] ุฅุถุงูุฉ Memory Summarization ูุชูููู ุนุฏุฏ ุงูุฑุณุงุฆู ุงููุญููุธุฉ
- [ ] ุฅุถุงูุฉ Memory Compression ููุฑุณุงุฆู ุงูุทูููุฉ
- [ ] ุฅุถุงูุฉ Memory Expiration ูููุญุงุฏุซุงุช ุงููุฏููุฉ
- [ ] ุชุญุณูู System Prompt ุจูุงุกู ุนูู feedback ุงููุณุชุฎุฏููู

## โ ุงูุชุญูู ูู ุงูุฅุนุฏุงุฏ

```bash
# ุงูุชุญูู ูู ุงูุญุฒู ุงููุซุจุชุฉ
npm list langchain @langchain/core @langchain/openai

# ุงูุชุญูู ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก
npm run lint

# ุจูุงุก ุงููุดุฑูุน
npm run build
```

---

**ุชู ุฅุนุฏุงุฏ LangChain ุจูุฌุงุญ! ๐**

















